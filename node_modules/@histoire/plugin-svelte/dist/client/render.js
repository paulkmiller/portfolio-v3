import{defineComponent as C,ref as g,watch as R,onMounted as O,onUnmounted as j,h as E}from"@histoire/vendors/vue";import{components as w}from"@histoire/controls";import*as f from"virtual:$histoire-setup";import*as m from"virtual:$histoire-generated-global-setup";import b from"./RenderStory.svelte.js";import x from"./RenderVariant.svelte.js";import N from"./Wrap.svelte.js";import{syncState as V}from"./util.js";const P=C({name:"RenderStory",props:{variant:{type:Object,required:!0},story:{type:Object,required:!0},slotName:{type:String,default:"default"}},setup(t,{emit:i}){const u=g();let r,a,c=[];function $(n,s){document.addEventListener(n,s);const e=()=>document.removeEventListener(n,s);return c.push(e),{off:e}}async function l(){a=document.createElement("div"),u.value.appendChild(a);let n=[];const{off:s}=$("SvelteRegisterComponent",o=>{const{component:p}=o.detail;n.push(p)});r=new t.story.file.component({target:a,props:{Hst:{Story:b,Variant:x,...q()}},context:new Map(Object.entries({__hstStory:t.story,__hstVariant:t.variant,__hstSlot:t.slotName}))});let e=n.find(o=>o.$$===r.$$);s(),n=[];function d(){const o=e.$replace;o&&(e.$replace=(...p)=>{const S=o.apply(e,p);return e=S,h(),d(),S})}d();const{apply:v,stop:_}=V(t.variant.state,o=>{e.$inject_state(o)});c.push(_);function h(){e.$$.after_update.push(()=>{v(e.$capture_state())})}h(),v(e.$capture_state()),typeof(m==null?void 0:m.setupSvelte3)=="function"&&await m.setupSvelte3({app:r,story:t.story,variant:t.variant}),typeof(f==null?void 0:f.setupSvelte3)=="function"&&await f.setupSvelte3({app:r,story:t.story,variant:t.variant}),typeof t.variant.setupApp=="function"&&await t.variant.setupApp({app:r,story:t.story,variant:t.variant}),i("ready")}function y(){var n;r==null||r.$destroy(),a&&((n=a.parentNode)==null||n.removeChild(a),a=null),c.forEach(s=>s()),c=[]}return R(()=>t.story.id,async()=>{y(),await l()}),O(async()=>{await l()}),j(()=>{y()}),{el:u}},render(){return E("div",{ref:"el"})}});function q(){const t={};for(const i in w)t[i.substring(3)]=A(w[i]);return t}function A(t){function i(u){return new N({...u,props:{...u.props,controlComponent:t}})}return i}export{P as default};
